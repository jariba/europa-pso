// NQueens.bsh

import psengine.*;
import java.io.StringReader;

source("NQueensBoard.java");

String model = "NQueens";
int N = 8;

String generateModel(int n)
{
    StringBuffer buf = new StringBuffer();
    buf.append("typedef int [0 ").append(n-1).append("] Row;\n\n");
    
    buf.append("Row ");
    for (int i=0; i<n;i++) {
    	if (i>0)
    		buf.append(",");
    	buf.append("v").append(i);
    }
    buf.append(";\n\n");
    
    buf.append("AllDiff(");
    for (int i=0; i<n;i++) {
    	if (i>0)
    		buf.append(",");
    	buf.append("v").append(i);
    }
    buf.append(");\n\n");
    
    return buf.toString();
}

void loadModel()
{
	String nddlModel = generateModel(N);
	print(nddlModel);
	psengine.setAllowViolations(true);
	psengine.executeScript("nddl",new StringReader(nddlModel));
}

void printQueens()
{
    StringBuffer buf = new StringBuffer();
    
    buf.append("{");
    for (int i=0; i<N;i++) {
    	if (i>0)
    		buf.append(",");
    	buf.append(psengine.getGlobalVariables().get(i).toString());
    }
    buf.append("}");
    print(buf.toString());
}

void initQueens()
{	
	PSVariableList l = psengine.getGlobalVariables();	
	PSVarValue value = PSVarValue.getInstance(0);
	
	for (int i=0;i<N;i++) {
		v = l.get(i);
		v.specifyValue(value);
	}    		
}

void showQueens()
{
    f = desktop.makeNewFrame("Queens");
    f.getContentPane().add(new NQueensBoard(psengine,N));
    f.setSize(450,350);
}

void search()
{
}

loadModel();
initQueens();
showQueens();
search();

//desktop.makeNddlConsole();
