// Light.bsh

import psengine.*;
import java.util.List;
import java.util.Vector;

source("PlanStructure.bsh");
source("PlanStructureToPlexilConverter.bsh");

void loadModel()
{
	cwd = bsh.cwd;
    String nddlModel = cwd+"/Light.nddl";
    psengine.executeScript("nddl",nddlModel);
}

void createPlan()
{
	solver = desktop.makeSolver("PlannerConfig.xml", 0, 50);

	while (solver.hasFlaws())
		solver.step();
}

void showPlan()
{
    desktop.showTokens(psengine.getObjectsByType("LightMgr").get(0));
}

PlanStructure makePlanStructure()
{
	return EUROPAtoPlanStructure.translate(psengine.getTokens());	
}

String planStructureToPlexil(PlanStructure ps, List mappings)
{
	return PlanStructureToPlexilConverter.convertToPlexil(ps,mappings);
}

// Pascal : This is what you need to move to your CI component
void realTest()
{
    // Run when component starts :
	loadModel();
    createPlan();
	
	// Run when getPlan is invoked :
	PlanStructure ps = makePlanStructure();
	System.out.println(ps.toString()); // Real test doesn't need this
}

void debugTest()
{
	loadModel();
    createPlan();
	showPlan(); 
	PlanStructure ps = makePlanStructure();
	System.out.println(ps.toString()); 
	Vector mappings = new Vector();    
	String plexil = planStructureToPlexil(ps,mappings); 
	System.out.println(plexil); 	
}

void main()
{
    //realTest();
    debugTest();
}


main();

