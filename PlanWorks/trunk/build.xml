<?xml version="1.0"?>
<!-- $Id: build.xml,v 1.15 2003-06-30 21:52:45 taylor Exp $ -->
<project name="PlanWorks" default="planWorks" basedir=".">
  <description>
    PlanWorks Build and Run Targets
  </description>

  <property name="planworks.root" value="${basedir}"/>
  <property name="mysql.basedir" value="${planworks.root}/lib/mysql"/>
  <property name="mysql.datadir" value="${mysql.basedir}/data"/>
  <property name="mysql.log" value="${mysql.basedir}/log/mysql.log"/>
  <property name="mysql.log.err" value="${mysql.basedir}/log/mysql.error.log"/>
  <property name="mysql.sock" value="${mysql.basedir}/mysql.sock"/>
  <property name="mysql.tmpdir" value="${mysql.basedir}/tmp"/>
  <property name="mysql.bindir" value="${mysql.basedir}/bin"/>
  <!-- property name="junit.home" location="${env.JUNIT_HOME}"/ -->
  <property name="jfcunit.home" location="${planworks.root}/java/lib/JFCUnit"/>

  <target name="planWorks"  depends="check_jvm_2"
    description="-- launch application (compile dependency)">
    <ant dir="./" antfile="planWorks.xml"/>
  </target>

  <target name="planWorksProf" depends="check_jvm_2"
    description="-- launch application with profiling info">
    <ant dir="./" antfile="planWorks.xml" target="planWorksProf"/>
  </target>

  <target name="timelineViewTest" depends="check_jvm_2, cleanDb" 
      description="-- JFCunit test (compile, cleanDb dependencies)">
    <ant dir="./java/src/gov/nasa/arc/planworks/viz/views/test" 
       antfile="timeline-view-test.xml"/>
  </target>

  <target name="cleanCls" depends="check_jvm_2"
      description="-- delete the 'java/classes' directory tree">
    <ant dir="./java" antfile="build.xml" target="clean"/>
  </target>

  <target name="compile" depends="check_jvm_2"
      description="-- compile 'java/src' tree into 'java/classes' tree">
    <ant dir="./java" antfile="build.xml" target="compile"/>
  </target>

  <target name="cleanDb" unless="no.clean.db"
      description="-- delete loaded projects from data base, unless -Dno.clean.db=yes">
<!--
    <delete>
      <fileset dir="${planworks.root}/xml/db/data" includes="*.dbx"/>
      <fileset dir="${planworks.root}/xml/db/logs" includes="*.log"/>
      <fileset dir="${planworks.root}/xml/db/logs" includes="*.log*"/>
      <fileset dir="${planworks.root}/xml/db/proj" includes="*.xml"/>
    </delete>
-->
  </target>

  <!-- JVM checking from Tarang Patel -->

  <target name="check_jvm_1">
    <available property="jdk1.4+" classname="java.lang.CharSequence" />
    <condition property="correct.java">
      <equals arg1="${jdk1.4+}" arg2="true"/>
    </condition>
    <echo message="ant.java.version ${ant.java.version}"/>
  </target>

  <target name="check_jvm_2" depends="check_jvm_1" unless="correct.java">
    <fail message="Wrong JVM version: ${ant.java.version} => require jdk1.4.*"/>
  </target>

</project>
