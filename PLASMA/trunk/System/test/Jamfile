SubDir PLASMA System test ;

if ! $(PLASMA_READY) {

local model ;

#
# BASIC TESTS
#

ModuleObjects runTest.cc : System ;
ModuleObjects DefaultTestInit.cc : System ;

for model in
	# Rover.nddl basic-model.nddl k9.backtrack.moderate.nddl k9.nddl
{
  local exe = $(model:S=) ;
  NddlMain $(exe) : runTest.o DefaultTestInit.o : $(model) : System ;
  RunModuleMain run-$(exe) : $(exe) ;
  LocalDepends run-nddl-planner-tests : run-$(exe) ;
}

#
# INITIAL TESTS
#

NddlMain k9-initial : runInitialTest.cc : k9-initial.nddl : System ;
RunModuleMain run-k9-initial : k9-initial ;
# LocalDepends run-nddl-planner-tests : run-k9-initial ;

#
# TRANSACTION TESTS
#

ModuleObjects runTransactionTest.cc : System ;

for model in
	basic-types.nddl Rover-transaction.nddl basic-model-transaction.nddl k9.backtrack.moderate-transaction.nddl
	k9-transaction.nddl path-filter-transaction.nddl foreach-transaction.nddl force-object-distribution.nddl 
	resource-backtrack-test.nddl rejection.nddl constrain-transaction.nddl parent-predicate.nddl #backtr-long.nddl
	EOS-backtrack-test.nddl
	backtr.nddl
{
  local exe = $(model:S=) ;
  NddlMain $(exe) : runTransactionTest.o DefaultTestInit.o : $(model) : System ;
  RunModuleMain run-$(exe) : $(exe) : $(model:S=.xml) ;
  LocalDepends run-nddl-planner-tests : run-$(exe) ;
}

#
# PERFORMANCE TESTS
#

Main stackGenerator : stackGenerator.cc ;
ObjectHdrs stackGenerator.cc : [ FDirName $(PLASMA) Utils core ] ;
MakeLocate [ FAppendSuffix stackGenerator : $(SUFEXE) ] : $(SUBDIR) ;

rule FSatelliteModel {
  local arguments = $(1) ;
  return satellites-$(arguments:J=-).nddl ;
}

rule GenerateStack {
  local output = $(1) ;
  local generator = $(2) ;
  local arguments = $(3) ;
  Depends $(output) : $(generator) ;
  ARGUMENTS on $(output) = $(arguments) ;
  MakeLocate $(output) : $(SUBDIR) ;
}

actions GenerateStack {
  $(2) $(ARGUMENTS) $(1:S=) 
}

local numSatellites ;
for numSatellites in 1 10 50 100 {
  local numTargets ;
  for numTargets in 10 {
    local numParams ;
    for numParams in 0 10 {
      local numParamChoices ;
      for numParamChoices in 0 10 {
        if $(numParamChoices) <= $(numParams) {
          local model = [ FSatelliteModel $(numSatellites) $(numTargets) $(numParams) $(numParamChoices) ] ;
          local exe = $(model:S=) ;
          GenerateStack [ FGristFiles $(model) ] : [ FAppendSuffix stackGenerator : $(SUFEXE) ] : $(numSatellites) $(numTargets) $(numParams) $(numParamChoices) ;
          NddlMain $(exe) : runTest.o : $(model) : System : performance-tests ;
          RunModuleMain run-$(exe) : $(exe) ;
          LocalDepends run-performance-tests : run-$(exe) ;
        }
      }
    }
  }
}

#
# TestLanguage TEST
#



} # PLASMA_READY
