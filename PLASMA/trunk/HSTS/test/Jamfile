SubDir PLASMA HSTS test ;

if ! $(PLASMA_READY) {

#
# Heuristics Tests
#

HSTS_Test_Files = [ FGristFiles AtSubgoalRule HSTSModuleTests ] ;
ModuleObjects $(HSTS_Test_Files:S=.cc) : HSTS ;

ModuleMain hsts-module-tests : $(HSTS_Test_Files:S=$(SUFOBJ)) module-tests.cc : HSTS : CBPlanner ;
RunModuleMain run-hsts-module-tests : hsts-module-tests ;
LocalDepends tests : run-hsts-module-tests ;

#
# EUROPA TESTS
#   Converted from NewPlan/ModuleTests/Parser, e.g.
#
ModuleObjects runEUROPAtest.cc : HSTS ;

rule RunEUROPATest {

 local target = $(1) ;
 local initialStates = $(2) ;
 local heur = $(3) ;
 local pid = $(4) ;

 local model ;
 for model in $(initialStates) {
  local exe = $(model:S=) ;
  local hh = $(model:S=.hh) ;
  local cc = [ FGristFiles $(model:S=.cc) ] ;
  local xml = $(model:S=.xml) ;
  local o = $(cc:S=.o) ;
  local lib = $(model:S=) ;
  local options = " -i "$(xml) ;
  if $(heur) {
    options += " -h "$(heur) ;
  }
  if ($pid) {
    options += " -p "$(pid) ;
  }

  # create .hh, .cc, .o, and .xml for a .nddl
  Includes $(cc) : $(hh) ;
  NddlCompiler $(hh) $(cc) : $(model) ;
  ModuleObjects $(cc) : NDDL ;

  # create planner with linked model
  ModuleMain $(exe) : $(o) runEUROPAtest.o : HSTS ;
  RunModuleMain run-$(exe) : $(exe) : $(options) ;
  LocalDepends $(target) : run-$(exe) ;
 }
}

RunEUROPATest monkey-timeline : timeline.nddl ;
RunEUROPATest monkey-timeline-hacked : timeline-hacked.nddl ;
RunEUROPATest monkey-timeline-hacked2 : timeline-hacked2.nddl ;
RunEUROPATest monkey-timeline-hacked3 : timeline-hacked3.nddl ;

# Failing; see GNATS 2759, 2760, and 2701.
#RunEUROPATest monkey1Tests : timeline1.nddl timeline-objvar.nddl timeline-twomonkeys-objvar.nddl timeline-twomonkeys.nddl ;

RunEUROPATest monkey2-timeline2 : timeline2.nddl ; 
RunEUROPATest monkey2-timeline22 : timeline22.nddl ;
RunEUROPATest monkey2-timeline23 : timeline23.nddl ;

RunEUROPATest robotTests : req1.nddl ;

# These fail; converter used explicit bounds on a temporal constraint, which the NDDL compiler does not support.
#   Reported in GNATS 2762.
# Also, the NDDL compiler printed the wrong file name for the error: rover.nddl rather than rover-test.nddl,
#     rover3.nddl rather than rover3-test.nddl, rover4.nddl rather than rover4-test.nddl, and
#     multrover.nddl rather than multrover-test.nddl.
#   Reported in GNATS 2761.
# RunEUROPATest roverTests : rover-test.nddl rover3-test.nddl rover4-test.nddl multrover-test.nddl ;

# These use constraint tokens, which Europa2 (PLASMA) does not support.
#   Verified as mentioned in PLASMA/MigrationNotes (entry 8 currently).
# RunEUROPATest roverTests : rover2-test.nddl rover2a-test.nddl rover2b-test.nddl ;

# Converter and/or NDDL compiler has bugs.  Reported as GNATS 2763.
# RunEUROPATest merTests : R1-files-p1.nddl R1-files-p2.nddl R1-files-p3.nddl R2-files-R21-Bill.nddl R2-files-R21-IDD1.nddl
#         R2-files-R21-IDD2.nddl R2-files-R21-IDD3.nddl R2-files-R21-PMA1.nddl R2-files-R21-PMA2.nddl
#         mer-1.nddl mer-bill-2.nddl mer-bill.nddl mer-idd1.nddl mer-idd2.nddl mer-idd3.nddl mer-pma-comm.nddl mer-pma1.nddl mer-pma2.nddl ;

#RunEUROPATest gnatsTests : C3-init.nddl NoBranchBug-init.nddl
#P4-C3-init.nddl P4-C3eq-init.nddl SC-init.nddl condasame-init.nddl 
#        rover-fixed-init.nddl sum-init.nddl ;

RunEUROPATest gnats-C3 : C3-init.nddl ;
RunEUROPATest gnats-NoBranchBug : NoBranchBug-init.nddl ;
RunEUROPATest gnats-P4-C3 : P4-C3-init.nddl ;
RunEUROPATest gnats-P4-C3eq : P4-C3eq-init.nddl ;
RunEUROPATest gnats-SC : SC-init.nddl ;
RunEUROPATest gnats-condasame : condasame-init.nddl ;
RunEUROPATest gnats-rover-fixed : rover-fixed-init.nddl ;
RunEUROPATest gnats-sum : sum-init.nddl ;

RunEUROPATest dnpTests : DNP.timeline.nddl ;

# Example; not yet converted or committed, requires implementation of constraints
# RunEUROPATest dnp3-fourFreeObs : dnp3-fourFreeObs-tx.nddl : dnp3.heuristics.xml : dnp3.heuristics.pid ;

} # PLASMA_READY
