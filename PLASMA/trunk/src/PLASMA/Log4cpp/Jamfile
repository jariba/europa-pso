SubDir PLASMA log4cpp ;

Module Log4cpp ;

versionDir = log4cpp-1.0 ;
log4cpp.baseDir = $(PLASMA_HOME)/src/PLASMA/Log4cpp ;
versionPath = $(log4cpp.baseDir)/$(versionDir) ;
buildPath = $(PLASMA_HOME)/build/lib ;

libraryMakeFile = $(versionPath)/Makefile ;
libraryFileName = liblog4cpp.so.4 ;
libraryBuildFile = $(versionPath)/src/.libs/$(libraryFileName) ;
debugLibraryFile = libLog4cpp_g.so ;
optimizedLibraryFile = libLog4cpp_o.so ;

rule setup.log4cpp
{
  Configure.log4cpp $(1) ;
}

rule build.log4cpp
{
  Make.log4cpp $(1) ;
}

rule install.log4cpp
{
  Copy.lib $(1) ;
  Depends all : $(libraryBuildFile) ;
}

Depends $(optimizedLibraryFile) : $(libraryMakeFile) $(libraryBuildFile) ;
Depends $(debugLibraryFile) : $(libraryMakeFile) $(libraryBuildFile) ;
Depends all : $(debugLibraryFile) $(optimizedLibraryFile) ;

actions Configure.log4cpp
{
  cd $(log4cpp.baseDir)
  echo -n "Unpacking $(versionDir).tar.bz2 in "
  pwd
  tar jxf $(versionDir).tar.bz2
  echo Running Log4cpp configure script ... this takes about 1 minute
  echo "  For details, see $(versionPath)/configure.log"
  cd $(versionPath);  ./configure > configure.log
}

actions Make.log4cpp
{
  echo Building Log4cpp  ... this can take a while on the first build
  echo "  running make in $(versionPath)/src"
  echo "  For details, see $(versionPath)/src/make.log  -- or tail -f that file"
  cd $(versionPath)/src; make > make.log
  cd $(PLASMA_HOME)/build/lib/
  cp  $(libraryBuildFile) .
}

actions Copy.lib
{
  cd $(PLASMA_HOME)/build/lib/
	ln -sf $(libraryFileName) $(1)
}

setup.log4cpp $(libraryMakeFile) ;
build.log4cpp $(libraryBuildFile) ;
install.log4cpp $(debugLibraryFile) ;
install.log4cpp $(optimizedLibraryFile) ;
